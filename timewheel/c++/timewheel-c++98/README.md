# C++98 时间轮定时器

这是一个使用C++98标准实现的时间轮定时器，支持多线程环境下的定时任务管理。

## 功能特性

- ✅ **C++98兼容**: 使用标准C++98语法，兼容老版本编译器
- ✅ **多线程安全**: 使用pthread实现线程安全
- ✅ **高效定时**: 基于时间轮算法，O(1)时间复杂度
- ✅ **回调机制**: 支持自定义回调函数
- ✅ **内存安全**: 自动管理定时器生命周期

## 编译和运行

### 编译
```bash
mkdir build && cd build
cmake ..
make
```

### 运行
```bash
./bin/cpp-timewheel-c98
```

## 代码结构

### 核心类
- **TimerWheel**: 时间轮主类
- **Timer**: 定时器对象结构体

### 关键方法
- `addTimer(delayMs, callback, arg)`: 添加定时器
- `start()`: 启动时间轮
- `stop()`: 停止时间轮
- `tick()`: 时间推进（内部方法）

## 使用示例

```cpp
// 创建时间轮：8个槽，每个tick=1秒
TimerWheel wheel(8, 1000);
wheel.start();

// 添加定时任务
wheel.addTimer(2000, taskPrint, (void*)"Task 1 after 2s");
wheel.addTimer(5000, taskPrint, (void*)"Task 2 after 5s");

// 等待任务执行
sleep(12);
wheel.stop();
```

## 算法原理

### 时间轮结构
- 使用固定大小的槽数组存储定时器
- 每个槽包含一个定时器链表
- 通过取模运算确定定时器位置

### 时间推进
- 工作线程每秒推进一个槽
- 检查当前槽中的定时器是否到期
- 到期则执行回调函数

### 线程安全
- 使用pthread_mutex保护共享数据
- 回调函数在锁外执行，避免死锁

## 性能特点

- **时间复杂度**: O(1) 添加定时器
- **空间复杂度**: O(n) 存储定时器
- **线程安全**: 支持多线程并发访问
- **内存效率**: 自动清理过期定时器

## 适用场景

- 网络连接超时管理
- 定时任务调度
- 缓存过期管理
- 心跳检测
- 延迟执行任务

## 注意事项

1. 回调函数在独立线程中执行
2. 定时器精度受系统调度影响
3. 大量定时器可能影响性能
4. 需要手动管理回调函数参数的生命周期
